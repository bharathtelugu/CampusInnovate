{% extends "base.html" %}

{% block content %}
<div class="container mx-auto p-4 md:p-8">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold text-gray-800">Staff Dashboard</h1>
        <a href="{% url 'logout' %}" class="text-sm font-medium text-indigo-600 hover:text-indigo-500">Log Out</a>
    </div>
    <p class="mb-8 text-lg text-gray-600">Welcome, {{ user.first_name }}! Here are the events you're involved with.</p>

    <!-- Section for Events I am managing/judging/volunteering for -->
    <div>
        <h2 class="text-2xl font-semibold mb-4 text-gray-700">My Assigned Events</h2>
        <div class="space-y-6">
            {% for staff_role in managed_events %}
                <div class="border p-6 rounded-lg shadow-md bg-white">
                    <div class="md:flex justify-between items-center">
                        <div>
                            <h3 class="text-2xl font-bold text-gray-800">{{ staff_role.event.event_name }}</h3>
                            <p class="text-gray-600">My Role: <span class="font-semibold text-blue-600 capitalize">{{ staff_role.role }}</span></p>
                            <p class="text-gray-600">Event Status: <span class="font-semibold text-green-600">{{ staff_role.event.get_status_display }}</span></p>
                        </div>
                        <div class="mt-4 md:mt-0 md:text-right">
                             <a href="{% url 'admin:events_event_change' staff_role.event.pk %}" class="text-sm text-gray-500 hover:underline" target="_blank">
                                Full Admin View &rarr;
                            </a>
                        </div>
                    </div>
                    
                    <hr class="my-4">

                    <!-- SMART ACTIONS: Show different buttons based on the user's role for THIS event -->
                    <div class="flex flex-wrap gap-4 items-center">
                        {% if 'manager' in staff_role.role|lower or 'organizer' in staff_role.role|lower %}
                            <a href="#" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Manage Participants</a>
                            <a href="#" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">View Submissions</a>
                        {% endif %}
                        
                        {% if 'judge' in staff_role.role|lower %}
                            <a href="#" class="bg-purple-600 text-white px-4 py-2 rounded-md hover:bg-purple-700">Open Judging Portal</a>
                        {% endif %}

                        {% if 'volunteer' in staff_role.role|lower %}
                             <a href="#" class="bg-gray-700 text-white px-4 py-2 rounded-md hover:bg-gray-800">View My Schedule</a>
                        {% endif %}
                         
                        <a href="{% url 'event-detail' staff_role.event.pk %}" class="text-indigo-500 hover:underline">View Public Event Page</a>
                    </div>
                </div>
            {% empty %}
                <div class="border-2 border-dashed border-gray-300 text-center p-8 rounded-lg">
                    <p class="text-gray-500">You are not currently assigned a role in any events.</p>
                     <a href="{% url 'admin:index' %}" class="mt-4 inline-block bg-indigo-600 text-white px-6 py-2 rounded-md hover:bg-indigo-700">Go to Admin Panel</a>
                </div>
            {% endfor %}
        </div>
    </div>

</div>
{% endblock %}
